---
import { getWeeklyPosts } from '~/utils/mock-data'
import StatCard from '~/components/ui/StatCard.astro'
import { cn } from '~/utils/utils'

const weeklyList = await getWeeklyPosts()
---

<section class="py-16 lg:py-20 bg-gradient-to-br from-gray-50/80 via-white to-blue-50/30 dark:from-gray-900/90 dark:via-gray-900 dark:to-blue-950/30 min-h-screen relative overflow-hidden">
    <!-- 背景装饰元素 -->
    <div class="absolute inset-0 pointer-events-none">
        <!-- 几何装饰 -->
        <div class="absolute top-20 left-10 w-32 h-32 bg-gradient-to-br from-blue-500/5 to-purple-500/5 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-32 right-16 w-24 h-24 bg-gradient-to-br from-purple-500/5 to-pink-500/5 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/3 w-16 h-16 bg-gradient-to-br from-emerald-500/5 to-teal-500/5 rounded-full blur-2xl animate-pulse" style="animation-delay: 4s;"></div>
        
        <!-- 网格背景 -->
        <div class="absolute inset-0 bg-[linear-gradient(rgba(59,130,246,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(59,130,246,0.03)_1px,transparent_1px)] dark:bg-[linear-gradient(rgba(96,165,250,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(96,165,250,0.02)_1px,transparent_1px)] bg-[size:60px_60px] opacity-40"></div>
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- 页面标题区域 -->
        <div class="text-center mb-16 lg:mb-20">
            <!-- 标签 -->
            <div class="inline-flex items-center px-6 py-3 rounded-2xl bg-white/80 dark:bg-gray-800/80 text-blue-600 dark:text-blue-400 text-sm font-semibold mb-8 border border-blue-200/50 dark:border-blue-800/50 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-500 hover:scale-105 group cursor-default">
                <div class="w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mr-3 animate-pulse"></div>
                <span class="tracking-wide">全部内容</span>
                <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-500/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            </div>
            
            <!-- 主标题 -->
            <h1 class="text-5xl lg:text-6xl xl:text-7xl font-black leading-[1.05] tracking-tight mb-8 font-heading">
                <span class="bg-gradient-to-r from-gray-900 via-blue-800 to-purple-800 dark:from-white dark:via-blue-200 dark:to-purple-200 bg-clip-text text-transparent">
                    周刊归档
                </span>
            </h1>
            
            <!-- 副标题 -->
            <p class="text-xl lg:text-2xl text-gray-600 dark:text-gray-300 max-w-4xl mx-auto leading-relaxed font-light mb-6">
                探索我们精心整理的技术周刊合集，每一期都是前端技术世界的精华摘要
            </p>
            
            <!-- 统计信息 -->
            <div class="flex flex-col sm:flex-row items-center justify-center gap-6 sm:gap-8 text-gray-500 dark:text-gray-400">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-xl flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                        </svg>
                    </div>
                    <span class="text-lg font-medium">共 <strong class="text-gray-900 dark:text-white">{weeklyList.length}</strong> 期周刊</span>
                </div>
                <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 hidden sm:block"></div>
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-emerald-500/20 to-teal-500/20 rounded-xl flex items-center justify-center">
                        <svg class="w-4 h-4 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <span class="text-lg font-medium">持续更新中</span>
                </div>
            </div>
        </div>

        <!-- 周刊网格 -->
        <div class={cn(
            "grid gap-8 lg:gap-10",
            "grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",
            "max-w-8xl mx-auto mb-16"
        )}>
            {weeklyList.map((weekly, index) => (
                <div 
                    class="animate-fade-in-up group" 
                    style={`animation-delay: ${Math.min(index * 0.05, 1)}s;`}
                    data-weekly-card
                >
                    <a href={`/weekly/${weekly.slug}`} class="block h-full focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-4 rounded-2xl">
                        <StatCard
                            title={weekly.title}
                            date={weekly.date}
                            tags={weekly.tags}
                        />
                    </a>
                </div>
            ))}
        </div>

        <!-- 底部装饰区域 -->
        <div class="text-center">
            <!-- 装饰性分隔线 -->
            <div class="flex items-center justify-center mb-8">
                <div class="h-px bg-gradient-to-r from-transparent via-gray-300 dark:via-gray-600 to-transparent flex-1 max-w-32"></div>
                <div class="mx-6 flex items-center gap-2 text-gray-500 dark:text-gray-400 text-sm font-medium">
                    <div class="w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full animate-pulse"></div>
                    <span class="tracking-wide">持续更新中</span>
                    <div class="w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full animate-pulse" style="animation-delay: 1s;"></div>
                </div>
                <div class="h-px bg-gradient-to-l from-transparent via-gray-300 dark:via-gray-600 to-transparent flex-1 max-w-32"></div>
            </div>
            
            <!-- 回到顶部按钮 -->
            <button 
                onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
                class="inline-flex items-center gap-3 px-6 py-3 bg-white/80 dark:bg-gray-800/80 text-gray-700 dark:text-gray-300 rounded-2xl border border-gray-200/50 dark:border-gray-700/50 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-2 group"
                aria-label="回到顶部"
            >
                <svg class="w-5 h-5 transition-transform duration-300 group-hover:-translate-y-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                </svg>
                <span class="font-medium tracking-wide">回到顶部</span>
            </button>
        </div>
    </div>
</section>

<style>
    /* 动画定义 */
    @keyframes fade-in-up {
        0% {
            opacity: 0;
            transform: translateY(40px) scale(0.95);
        }
        100% {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    .animate-fade-in-up {
        animation: fade-in-up 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
    }

    /* 网格布局优化 */
    .grid {
        display: grid;
        align-items: stretch;
    }

    /* 确保卡片高度一致 */
    .grid > div {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .grid > div > a {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    /* 响应式优化 */
    @media (max-width: 640px) {
        .grid {
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        
        h1 {
            font-size: 2.5rem;
            line-height: 1.1;
        }
        
        .text-xl {
            font-size: 1.125rem;
        }
    }

    @media (min-width: 641px) and (max-width: 768px) {
        .grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
    }

    @media (min-width: 1536px) {
        .grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 2.5rem;
        }
        
        .max-w-8xl {
            max-width: 88rem;
        }
    }

    /* 减少动画 */
    @media (prefers-reduced-motion: reduce) {
        .animate-fade-in-up {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        .animate-pulse {
            animation: none;
        }
    }

    /* 性能优化 */
    .grid > div {
        transform: translateZ(0);
        backface-visibility: hidden;
    }
    
    /* 高对比度模式 */
    @media (prefers-contrast: high) {
        .bg-gradient-to-r,
        .bg-gradient-to-br,
        .bg-gradient-to-l {
            background: hsl(var(--background)) !important;
        }
        
        .text-transparent {
            color: hsl(var(--foreground)) !important;
            background: none !important;
            -webkit-background-clip: unset !important;
            background-clip: unset !important;
        }
    }

    /* 触摸设备优化 */
    @media (hover: none) {
        .hover\:scale-105:hover,
        .hover\:-translate-y-1:hover {
            transform: none;
        }
    }
    
    /* 文字渲染优化 */
    h1 {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
    }
    
    /* 卡片悬停效果增强 */
    [data-weekly-card]:hover {
        z-index: 10;
    }
    
    /* 焦点状态增强 */
    a:focus-visible {
        outline: 2px solid hsl(var(--primary));
        outline-offset: 4px;
        border-radius: 1rem;
    }
    
    /* 加载状态 */
    .grid[data-loading="true"] > div {
        opacity: 0.5;
        pointer-events: none;
    }
    
    .grid[data-loading="true"] > div::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shimmer 1.5s linear infinite;
        border-radius: inherit;
    }
    
    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    /* 暗色模式特殊处理 */
    .dark .grid > div {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    /* 打印样式 */
    @media print {
        .animate-fade-in-up {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        button {
            display: none;
        }
    }
</style>