---
import { getLatestWeeklyPosts } from '~/utils/mock-data'
import StatCard from '~/components/ui/StatCard.astro'
import Button from '~/components/ui/Button.astro'
import { cn } from '~/utils/utils'

let latestWeeklyList;
try {
    latestWeeklyList = await getLatestWeeklyPosts(12);
    console.log('LatestWeeklyList Debug:', {
        count: latestWeeklyList.length,
        first: latestWeeklyList[0]?.title,
        data: latestWeeklyList.slice(0, 3).map(w => ({ id: w.id, title: w.title, tags: w.tags }))
    });
} catch (error) {
    console.error('Error loading weekly posts:', error);
    latestWeeklyList = [];
}
---

<section class="py-20 lg:py-24 bg-gradient-to-br from-gray-50/60 via-white to-blue-50/40 dark:from-gray-900/80 dark:via-gray-900 dark:to-blue-950/40 relative overflow-hidden">
    <!-- 背景装饰元素 -->
    <div class="absolute inset-0 pointer-events-none">
        <!-- 几何装饰 -->
        <div class="absolute top-32 left-16 w-40 h-40 bg-gradient-to-br from-blue-500/8 to-purple-500/8 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-40 right-20 w-32 h-32 bg-gradient-to-br from-purple-500/8 to-pink-500/8 rounded-full blur-3xl animate-pulse" style="animation-delay: 3s;"></div>
        <div class="absolute top-1/3 right-1/4 w-24 h-24 bg-gradient-to-br from-emerald-500/6 to-teal-500/6 rounded-full blur-2xl animate-pulse" style="animation-delay: 6s;"></div>
        
        <!-- 网格背景 -->
        <div class="absolute inset-0 bg-[linear-gradient(rgba(59,130,246,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(59,130,246,0.02)_1px,transparent_1px)] dark:bg-[linear-gradient(rgba(96,165,250,0.015)_1px,transparent_1px),linear-gradient(90deg,rgba(96,165,250,0.015)_1px,transparent_1px)] bg-[size:80px_80px] opacity-50"></div>
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- 标题区域 -->
        <div class="text-center mb-16 lg:mb-20">
            <!-- 标签 -->
            <div class="inline-flex items-center px-6 py-3 rounded-2xl bg-white/90 dark:bg-gray-800/90 text-blue-600 dark:text-blue-400 text-sm font-semibold mb-8 border border-blue-200/60 dark:border-blue-800/60 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-500 hover:scale-105 group cursor-default">
                <div class="w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mr-3 animate-pulse"></div>
                <span class="tracking-wide">最新内容</span>
                <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-500/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            </div>
            
            <!-- 主标题 -->
            <h2 class="text-4xl lg:text-5xl xl:text-6xl font-black leading-[1.05] tracking-tight mb-6 font-heading">
                <span class="bg-gradient-to-r from-gray-900 via-blue-800 to-purple-800 dark:from-white dark:via-blue-200 dark:to-purple-200 bg-clip-text text-transparent">
                    精选周刊
                </span>
            </h2>
            
            <!-- 副标题 -->
            <p class="text-xl lg:text-2xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto leading-relaxed font-light">
                每周精心筛选的前端技术内容，助你保持技术敏锐度
            </p>
        </div>

        <!-- 卡片网格 -->
        <!-- Debug: 数据长度 {latestWeeklyList.length} -->
        {latestWeeklyList.length > 0 ? (
            <div class={cn(
                "grid gap-6 md:gap-8",
                "grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",
                "2xl:grid-cols-4 auto-cols-fr",
                "mb-16 lg:mb-20 max-w-8xl mx-auto weekly-grid"
            )}>
                {latestWeeklyList.map((weekly, index) => (
                    <div 
                        class="animate-fade-in-up group" 
                        style={`animation-delay: ${index * 0.08}s;`}
                        data-weekly-card
                    >
                        <a href={`/weekly/${weekly.slug}`} class="block h-full focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-4 rounded-2xl">
                            <StatCard
                                title={weekly.title}
                                date={weekly.date}
                                tags={weekly.tags}
                                desc={weekly.content ? weekly.content.substring(0, 100) + '...' : undefined}
                            />
                        </a>
                    </div>
                ))}
            </div>
        ) : (
            <div class="text-center py-12">
                <p class="text-gray-500 dark:text-gray-400 text-lg">暂无周刊数据</p>
            </div>
        )}

        <!-- 查看更多按钮区域 -->
        <div class="text-center">
            <!-- 装饰性分隔线 -->
            <div class="flex items-center justify-center mb-10">
                <div class="h-px bg-gradient-to-r from-transparent via-gray-300 dark:via-gray-600 to-transparent flex-1 max-w-40"></div>
                <div class="mx-8 flex items-center gap-2 text-gray-500 dark:text-gray-400 text-sm font-medium">
                    <div class="w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full animate-pulse"></div>
                    <span class="tracking-wide">探索更多</span>
                    <div class="w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full animate-pulse" style="animation-delay: 1s;"></div>
                </div>
                <div class="h-px bg-gradient-to-l from-transparent via-gray-300 dark:via-gray-600 to-transparent flex-1 max-w-40"></div>
            </div>
            
            <!-- CTA 按钮 -->
            <div class="relative inline-block group">
                <!-- 背景光晕 -->
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-pink-500/20 rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 scale-110"></div>
                
                <Button 
                    href="/weekly"
                    variant="secondary"
                    size="lg"
                    class="relative px-8 py-4 text-lg font-semibold bg-white/90 dark:bg-gray-800/90 border border-gray-300/60 dark:border-gray-700/60 shadow-lg hover:shadow-xl backdrop-blur-xl transition-all duration-300 hover:scale-105 hover:-translate-y-1 focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-4"
                >
                    <!-- 按钮图标 -->
                    <span class="tracking-wide">查看全部周刊</span>
                    
                    <!-- 微光效果 -->
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 -skew-x-12 -translate-x-full group-hover:translate-x-full transform rounded-2xl"></div>
                </Button>
            </div>
        </div>
    </div>
</section>

<style>
    /* 动画定义 */
    @keyframes fade-in-up {
        0% {
            opacity: 0;
            transform: translateY(40px) scale(0.95);
        }
        100% {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    .animate-fade-in-up {
        animation: fade-in-up 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
    }

    /* 网格布局优化 */
    .grid {
        display: grid;
        align-items: stretch;
    }

    /* 确保卡片高度一致 */
    .grid > div {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .grid > div > a {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    /* 智能响应式网格 */
    .weekly-grid {
        /* 使用 CSS Grid 的 auto-fit 和 minmax 来实现智能响应式 */
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    
    /* 响应式优化 */
    @media (max-width: 480px) {
        .weekly-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        h2 {
            font-size: 2.25rem;
            line-height: 1.1;
        }
        
        .text-xl {
            font-size: 1.125rem;
        }
    }

    @media (min-width: 481px) and (max-width: 640px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.5rem;
        }
    }

    @media (min-width: 641px) and (max-width: 768px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
    }

    @media (min-width: 1025px) and (max-width: 1280px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
        }
    }

    @media (min-width: 1281px) and (max-width: 1536px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 2.5rem;
        }
    }

    @media (min-width: 1537px) {
        .weekly-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 2.5rem;
        }
    }

    /* 减少动画 */
    @media (prefers-reduced-motion: reduce) {
        .animate-fade-in-up {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        .animate-pulse {
            animation: none;
        }
    }

    /* 触摸设备优化 */
    @media (hover: none) {
        .hover\:scale-105:hover,
        .hover\:-translate-y-1:hover {
            transform: none;
        }
    }
    
    /* 文字渲染优化 */
    h2 {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
    }
    
    /* 高对比度模式 */
    @media (prefers-contrast: high) {
        .bg-gradient-to-r,
        .bg-gradient-to-br {
            background: hsl(var(--background)) !important;
        }
        
        .text-transparent {
            color: hsl(var(--foreground)) !important;
            background: none !important;
            -webkit-background-clip: unset !important;
            background-clip: unset !important;
        }
    }
    
    /* 性能优化 */
    .grid > div {
        transform: translateZ(0);
        backface-visibility: hidden;
    }
    
    /* 卡片悬停效果增强 */
    [data-weekly-card]:hover {
        z-index: 10;
    }
    
    /* 焦点状态增强 */
    a:focus-visible {
        outline: 2px solid hsl(var(--primary));
        outline-offset: 4px;
        border-radius: 1rem;
    }
    
    /* 按钮增强效果 */
    .group:hover .relative {
        transform: translateY(-2px) scale(1.05);
    }
    
    /* 暗色模式特殊处理 */
    .dark .grid > div {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    /* 打印样式 */
    @media print {
        .animate-fade-in-up {
            animation: none;
            opacity: 1;
            transform: none;
        }
    }
</style>